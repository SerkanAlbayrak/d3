{
  "hash": "bf0ec7b629b75afd6789f7daa295f99b",
  "result": {
    "markdown": "---\ntitle: \"Bar Chart ile Çapraz Tablo Görselleştirme\"\nauthor: Raif Serkan Albayrak\ndescription: \"Çapraz tabloların bar chart'lar kullanılarak nasıl görselleştirilebileceği üzerine bir yazı.\"\ndate: 2022-09-21\ncategories:\n  - ggplot\n  - bar chart\ncode-fold: true\nimage: \"img/preview.png\"\nlang: tr\ncode-line-numbers: false\ntoc-title: İçerik\n---\n\n\nBar chart'lar veri bilimcilerin ne tercih ettiği gösterim cihazları arasındadır. Sadeliği fonksiyonellikle harmanlayan bir yapıları vardır. Bu yazıda çapraz tabloları bar chart kullanarak görselleştirme yöntemi anlatıldı. Teknik anlatımın arasına pek çok kişiye faydası olabilecek bir de tecrübe sıkıştırdık.   \n\nAnlatımda kullanılan veri 2022 YKS sonuçlarına göre İzmir Ekonomi Üniversitesi'ne yerleşen öğrencilerin öğrencilere yapılan bir ankette sorulan iki sorunun yanıtlarından oluşmaktadır. 2022 yılında ilk yerleştirmede İEU'ya 2395 öğrenci yerleşti ancak bunların 2260'ı kayıt oldu. Anket bu öğrencilerin 1989'una yapıldı. Yeni kaydolan öğrenciler, öğrenci işlerinin kayıt masalarında işlerini tamamlayıp son adımda öğrenci kartlarına teslim aldıklarından sonra YKS tanıtım sürecinde de çalışan öğrenciler arasıdan seçilen bir grup öğrencinin anketörlüğünde ankete katıldılar. \n\nBu yazıda ankette koşullu olarak birbirine bağlı şekilde sorulan:\n\n* 4. İzmir Ekonomi'nin kampüsünü daha önce ziyaret ettin mi?\n  * Evet\n  * Hayır\n* 5. Kampüs ziyaretin tercihinde etkili oldu mu? *\n  * Evet\n  * Hayır\n  * Kararsızım\n\nsorularına verdikleri yanıtların verisi kullanıldı.\n\n\n\n::: {.cell warnings='false'}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nkampusetki <- function(e){\n  g1 <- ggplot(e,aes(fill=`Kampüs ziyaretin tercihinde etkili oldu mu?`,\n                     x=`Kampüs Ziyareti`,\n                     y=p2)) + \n    geom_bar(stat = \"identity\",color=\"black\") +\n    scale_y_continuous(labels=scales::percent,limits = c(0,1),expand = c(0,0)) + ylab(\"Oran\") +\n    ggrepel::geom_label_repel(aes(label=ifelse(p1==1,element_blank(),paste0(\"%\",sprintf(\"%1.1f\", p1*100)))),\n              colour=\"black\", size = 4,fontface = \"bold\",\n              position=position_stack(vjust=0.5),show.legend=FALSE) + \n    labs(fill = \"Kampüs ziyaretin \\ntercihinde etkili \\noldu mu?\") +\n    geom_label(aes(label = paste0(\"%\",sprintf(\"%1.2f\", after_stat(y)*100)),\n                  group =`Kampüs Ziyareti`), stat='summary', fun=sum,\n                  vjust=-1,size=5,fill=\"white\")\n  return(g1)\n}\n\nizmirkampus <- function(e){\n    g1 <- ggplot(e,aes(x=`Geldiği Şehir`,\n                    fill=`Kampüs Ziyareti`,\n                   y=p2)) + \n  geom_bar(stat = \"identity\",color=\"black\") +\n  scale_y_continuous(labels=scales::percent,limits = c(0,1),\n                     expand = c(0,0)) + ylab(\"Oran\") +\n  geom_label(aes(label=ifelse(p1==1,element_blank(),\n                              paste0(\"%\",sprintf(\"%1.1f\",p1*100)))),\n             colour=\"black\", size = 4,fontface = \"bold\",\n             position=position_stack(vjust=0.5), show.legend=FALSE)+\n      labs(fill = \"Kampüs ziyareti\")+\n  geom_label(aes(label = paste0(\"%\",sprintf(\"%1.2f\", after_stat(y)*100)),\n                  group =`Geldiği Şehir`), stat='summary', fun=sum,\n                  vjust=-1,size=5,fill=\"white\")\n    \n  return(g1)\n}\n```\n:::\n\n\nVeride ilgilenilen değişkenler aşağıdaki özet tabloda sağda bulunan üç sütunda gösteriliyor. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nAnketLise[1:10,c(1:3,20,44,45)] |> kbl() |> kable_styling()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> ID </th>\n   <th style=\"text-align:left;\"> Start time </th>\n   <th style=\"text-align:left;\"> Completion time </th>\n   <th style=\"text-align:left;\"> Kampüs ziyaretin tercihinde etkili oldu mu? </th>\n   <th style=\"text-align:left;\"> Geldiği Şehir </th>\n   <th style=\"text-align:left;\"> Kampüs Ziyareti </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 9 </td>\n   <td style=\"text-align:left;\"> 2022-08-22 09:06:41 </td>\n   <td style=\"text-align:left;\"> 2022-08-22 09:09:05 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> İzmir </td>\n   <td style=\"text-align:left;\"> Evet </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 10 </td>\n   <td style=\"text-align:left;\"> 2022-08-22 09:11:00 </td>\n   <td style=\"text-align:left;\"> 2022-08-22 09:13:35 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> Şehirdışı </td>\n   <td style=\"text-align:left;\"> Hayır </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 11 </td>\n   <td style=\"text-align:left;\"> 2022-08-22 09:14:55 </td>\n   <td style=\"text-align:left;\"> 2022-08-22 09:16:48 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> İzmir </td>\n   <td style=\"text-align:left;\"> Hayır </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 12 </td>\n   <td style=\"text-align:left;\"> 2022-08-22 08:46:54 </td>\n   <td style=\"text-align:left;\"> 2022-08-22 09:17:12 </td>\n   <td style=\"text-align:left;\"> Evet </td>\n   <td style=\"text-align:left;\"> İzmir </td>\n   <td style=\"text-align:left;\"> Evet </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 13 </td>\n   <td style=\"text-align:left;\"> 2022-08-22 08:44:36 </td>\n   <td style=\"text-align:left;\"> 2022-08-22 09:19:49 </td>\n   <td style=\"text-align:left;\"> Evet </td>\n   <td style=\"text-align:left;\"> İzmir </td>\n   <td style=\"text-align:left;\"> Evet </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 14 </td>\n   <td style=\"text-align:left;\"> 2022-08-22 09:20:02 </td>\n   <td style=\"text-align:left;\"> 2022-08-22 09:21:29 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> Şehirdışı </td>\n   <td style=\"text-align:left;\"> Hayır </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 17 </td>\n   <td style=\"text-align:left;\"> 2022-08-22 08:45:45 </td>\n   <td style=\"text-align:left;\"> 2022-08-22 09:24:50 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> Şehirdışı </td>\n   <td style=\"text-align:left;\"> Hayır </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 18 </td>\n   <td style=\"text-align:left;\"> 2022-08-22 09:27:13 </td>\n   <td style=\"text-align:left;\"> 2022-08-22 09:31:39 </td>\n   <td style=\"text-align:left;\"> Evet </td>\n   <td style=\"text-align:left;\"> Şehirdışı </td>\n   <td style=\"text-align:left;\"> Evet </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 19 </td>\n   <td style=\"text-align:left;\"> 2022-08-22 09:29:54 </td>\n   <td style=\"text-align:left;\"> 2022-08-22 09:33:13 </td>\n   <td style=\"text-align:left;\"> Evet </td>\n   <td style=\"text-align:left;\"> İzmir </td>\n   <td style=\"text-align:left;\"> Evet </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 20 </td>\n   <td style=\"text-align:left;\"> 2022-08-22 09:30:35 </td>\n   <td style=\"text-align:left;\"> 2022-08-22 09:34:06 </td>\n   <td style=\"text-align:left;\"> Evet </td>\n   <td style=\"text-align:left;\"> İzmir </td>\n   <td style=\"text-align:left;\"> Evet </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\nAmaçlanan grafik aşağıda veriliyor. İlk grafikte öğrenciler kampüs ziyareti yapmalarına göre yatayda gruplandırılıyorlar. Buna göre öğrencilerin yaklaşık %72'si kampüs ziyareti yapmış. Kampüs ziyareti yaptığını belirten öğrenciler daha sonra renk kodlarıyla bu ziyaretin tercihinde etkili olup olmadığına göre gruplanıyor.\n\nRenk gruplarının içinde yazan oranlar, ilgili kısım içindeki oranı yani göreli oranı ifade ediyor. Buna göre kampüs ziyareti yapanların yaklaşık %70'i için bu ziyaret tercihinde etkili olmuş. Gri renk ile etiketlenen grup kampüs ziyaretinin etkisi konusunda hiçbir fikir belirtmek istemeyen öğrencileri gösteriyor. Kampüs ziyareti yapmayan öğrencilerin tamamı bu soruyla karşılaşmadıkları için doğal olarak bu grubun üyesi oluyor.  \n\nİkinci grafikte ise öğrencilerin İzmir'den veya şehir dışından gelmelerine göre kampüsü ziyaret etme oranları gösteriliyor. Öğrencinin geldiği yeri belirlemede ÖSYM'den yerleşen öğrencilerle ilgili gönderilen verinin adres veya nüfuse kayıtlı olduğu şehir bilgisi değil, mezun olduğu lisenin bulunduğu şehir bilgisi kullanıldığı detayını da paylaşmakta fayda var.\n\n::: {.column-margin}\n\nTam bu noktada alternatif bir gösterim tercih edilebilirdi ve aslında anket raporunun ilk versiyonunda bu gösterim kullanıldı ve hatta kullanılmasında analist ısrarcı oldu. Bu versiyonda renkli kısımlarda gösterilen oranlar bütün içindeki oranı göstermekteydi. Buna göre kırmızı alanda %69.6 yerine %50 yazıyordu. Dolayısıyla bir çırpıda öğrencilerin yarısının kampüs ziyareti yaptığı **VE** bu ziyaretin tercihinde etkili olduğu görülebiliyordu. Ancak yapılan sunumlarda bu gösterim dinleyiciler tarafından beğenilmedi ve sezgisel olmadığı söylendi. Bütün içindeki oran yerine ilgili grup içindeki oranın gösterilmesi talep edildi.\n\n:::\n\n  \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ne1 <- AnketLise |> select(c(20,44,45)) |> \n  group_by_at(c(3,1)) |> tally() |> mutate(p1=n/sum(n)) |> ungroup() |> \n  mutate(p2=n/sum(n)) \nprint(kampusetki(e1))\n```\n\n::: {.cell-output-display}\n![](crossTableBarChart_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\ne2 <- AnketLise |> select(c(44,45)) |> \n  group_by_at(c(1,2)) |> tally() |>  mutate(p1=n/sum(n)) |> ungroup() |> \n  mutate(p2=n/sum(n))\nprint(izmirkampus(e2))\n```\n\n::: {.cell-output-display}\n![](crossTableBarChart_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n:::\n\n\nGrafiği çizen fonksiyonlar sıradan ancak grafiğe sokulan verinin hazırlanmasında birkaç ilginç nokta var. Grafiklere giren veri aynı mantıkla hazırlandığı için ikinci grafikte gösterilen verinin hazırlanmasına bakılıyor. Veride 44,45'te sırasıyla öğrencinin geldiği yer bilgisi (İzmir ya da Şehir dışı) ve kampüs ziyareti yapıp yapmadığı bilgisi (Evet, Hayır) bulunmakta. Değişken isimlerini kullanmaktansa sütun numarasına göre gruplama yapabilmek amacıyla `group_by_at` kullanıldı. Devamında `tally()` ile frekans tablosu oluşturuldu.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nAnketLise |> select(c(44,45)) |> group_by_at(c(1,2)) |> tally() \n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Geldiği Şehir </th>\n   <th style=\"text-align:left;\"> Kampüs Ziyareti </th>\n   <th style=\"text-align:right;\"> n </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> İzmir </td>\n   <td style=\"text-align:left;\"> Evet </td>\n   <td style=\"text-align:right;\"> 1008 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> İzmir </td>\n   <td style=\"text-align:left;\"> Hayır </td>\n   <td style=\"text-align:right;\"> 229 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Şehirdışı </td>\n   <td style=\"text-align:left;\"> Evet </td>\n   <td style=\"text-align:right;\"> 313 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Şehirdışı </td>\n   <td style=\"text-align:left;\"> Hayır </td>\n   <td style=\"text-align:right;\"> 288 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n`tally()`'nin oluşturduğu **n** değişkenini kullanarak göreli oranlar ilk değişkene göre hesaplanıyor.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nAnketLise |> select(c(44,45)) |> group_by_at(c(1,2)) |> tally() |> \n   mutate(p1=n/sum(n))\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Geldiği Şehir </th>\n   <th style=\"text-align:left;\"> Kampüs Ziyareti </th>\n   <th style=\"text-align:right;\"> n </th>\n   <th style=\"text-align:right;\"> p1 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> İzmir </td>\n   <td style=\"text-align:left;\"> Evet </td>\n   <td style=\"text-align:right;\"> 1008 </td>\n   <td style=\"text-align:right;\"> 0.8148747 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> İzmir </td>\n   <td style=\"text-align:left;\"> Hayır </td>\n   <td style=\"text-align:right;\"> 229 </td>\n   <td style=\"text-align:right;\"> 0.1851253 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Şehirdışı </td>\n   <td style=\"text-align:left;\"> Evet </td>\n   <td style=\"text-align:right;\"> 313 </td>\n   <td style=\"text-align:right;\"> 0.5207987 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Şehirdışı </td>\n   <td style=\"text-align:left;\"> Hayır </td>\n   <td style=\"text-align:right;\"> 288 </td>\n   <td style=\"text-align:right;\"> 0.4792013 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\nSon adımda bütüne göre oranları hesaplamak için gruplama işlemi `ungroup()` ile iptal ediliyor ve oranlar hesaplanıyor. Bu şekilde **p1** ile bar'ların içindeki oranlar **p2** ile barların toplam içindeki oranları hesaplanmış oluyor.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nAnketLise |> select(c(44,45)) |>  group_by_at(c(1,2)) |> tally() |>  \n  mutate(p1=n/sum(n)) |> ungroup() |> mutate(p2=n/sum(n))\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Geldiği Şehir </th>\n   <th style=\"text-align:left;\"> Kampüs Ziyareti </th>\n   <th style=\"text-align:right;\"> n </th>\n   <th style=\"text-align:right;\"> p1 </th>\n   <th style=\"text-align:right;\"> p2 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> İzmir </td>\n   <td style=\"text-align:left;\"> Evet </td>\n   <td style=\"text-align:right;\"> 1008 </td>\n   <td style=\"text-align:right;\"> 0.8148747 </td>\n   <td style=\"text-align:right;\"> 0.5484222 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> İzmir </td>\n   <td style=\"text-align:left;\"> Hayır </td>\n   <td style=\"text-align:right;\"> 229 </td>\n   <td style=\"text-align:right;\"> 0.1851253 </td>\n   <td style=\"text-align:right;\"> 0.1245919 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Şehirdışı </td>\n   <td style=\"text-align:left;\"> Evet </td>\n   <td style=\"text-align:right;\"> 313 </td>\n   <td style=\"text-align:right;\"> 0.5207987 </td>\n   <td style=\"text-align:right;\"> 0.1702938 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Şehirdışı </td>\n   <td style=\"text-align:left;\"> Hayır </td>\n   <td style=\"text-align:right;\"> 288 </td>\n   <td style=\"text-align:right;\"> 0.4792013 </td>\n   <td style=\"text-align:right;\"> 0.1566921 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n",
    "supporting": [
      "crossTableBarChart_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\r\n<link href=\"../../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}